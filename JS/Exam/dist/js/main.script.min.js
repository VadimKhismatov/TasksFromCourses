"use strict";

function imagesService() {

    var self = this;
    self.random = random;
    self.search = search;

    function random(callback) {

        var request = new XMLHttpRequest();

        request.open("GET", "http://pixabay.com/api/?key=3892617-2883036288160f7e76309a559&response_group=image_details&per_page=7", true);

        request.onreadystatechange = function () {

            if (request.readyState == 4) {
                if (request.status == 200) {
                    var data = JSON.parse(request.responseText);
                    callback(data);
                    //console.log(data);
                }
            }
        };

        request.send();
    };

    function search(query, callback) {

        var request = new XMLHttpRequest();

        if (query.length > 0) {

            request.open("GET", "http://pixabay.com/api/?key=3892617-2883036288160f7e76309a559&q=" + encodeURIComponent(query) + "&response_group=image_details&per_page=7");

            request.onreadystatechange = function () {

                if (request.readyState == 4) {
                    if (request.status == 200) {
                        var data = JSON.parse(request.responseText);
                        callback(data);
                    }
                }
            };

            request.send();
        } else {
            return;
        }
    };
};
function Slider() {

    var slider = document.querySelector("#article").childNodes[2].nextSibling;
    //var slider = document.querySelector("#slider");
    console.log("slider", slider);

    var currentWidth = getComputedStyle(slider).width;
    currentWidth = parseInt(currentWidth.slice(0, currentWidth.indexOf("px")));
    console.log("width", width);
    var width = 0;
    var nextBtn = document.querySelector("#next");
    var backBtn = document.querySelector("#back");
    var slidesContainer = slider.childNodes[0].nextSibling;
    console.log("slidesContainer", slidesContainer);
    var slides = slidesContainer.querySelectorAll(".about__article__slide");
    console.log("slides", slides);
    var lastSlide = slides.length - 1;
    var currentSlide = 1;

    function nextSlide() {
        if (currentSlide === slides.length) {
            slidesContainer.style.marginLeft = "0px";
            currentSlide = 1;
            width = currentWidth;
        } else {
            slidesContainer.style.marginLeft = "-" + width + "px";
            width += width;
            currentSlide++;
        }
        //console.log("next function work");
    };

    function backSlide() {
        if (currentSlide === 1) {
            slidesContainer.style.marginLeft = "-" + 300 * lastSlide + "px";
            currentSlide = slides.length;
            width = 300 * lastSlide;
        } else {
            width -= 300;
            slidesContainer.style.marginLeft = "-" + width + "px";
            currentSlide--;
        }
        //console.log("back function work");
    };

    nextBtn.addEventListener("click", nextSlide);
    backBtn.addEventListener("click", backSlide);

};

"use strict";

//app.js
window.onload = function () {
    Slider();

    var service = new imagesService();
    var search_btn = document.querySelector("#search-btn");
    //console.log("search_btn:", search_btn);

    service.random(function (data) {
        render(data);
    });

    var render = function render(data) {
        //console.log("data from render", data);

        var images_wrapper = document.querySelector("#holidays__ideas_box");

        var images = "";

        for (var i = 0; i <= 6; i++) {

            if (i == 4) {
                images += '<div class="holidays__idea holidays__idea--wider animated fadeInLeft" style="background-image: url(' + data.hits[i].webformatURL + ');"><a href="' + data.hits[i].pageURL + '" target="_blank"><div class="idea__text_wrapper"><p class="idea__title">' + data.hits[i].tags + '</p></div></a></div>';
            } else if (i == 5) {
                images += '<div class="holidays__idea holidays__idea--wider animated fadeInLeft" style="background-image: url(' + data.hits[i].webformatURL + ');"><a href="' + data.hits[i].pageURL + '" target="_blank"><div class="idea__text_wrapper"><p class="idea__title">' + data.hits[i].tags + '</p></div></a></div>';
            } else {
                images += '<div class="holidays__idea animated fadeInLeft" style="background-image: url(' + data.hits[i].webformatURL + ');"><a href="' + data.hits[i].pageURL + '" target="_blank"><div class="idea__text_wrapper"><p class="idea__title">' + data.hits[i].tags + '</p></div></a></div>';
            }

            //console.log("image", data.hits[i].webformatURL);
        }
        //console.log("images", images);

        images_wrapper.innerHTML = "";
        images_wrapper.innerHTML = images;
    };

    var searchImages = function searchImages() {
        var query = document.querySelector("#search-input").value;
        //console.log("search query input: ", query);

        service.search(query, function (data) {
            render(data);
        });
    };

    if (search_btn.addEventListener) {
        search_btn.addEventListener('click', searchImages);
    } else if (search_btn.attachEvent) {
        search_btn.attachEvent('onclick', searchImages);
    }
};